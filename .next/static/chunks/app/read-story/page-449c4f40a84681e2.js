(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[515],{63:(e,t,a)=>{"use strict";var r=a(7260);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},358:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(4294).A)("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]])},926:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{callServer:function(){return r.callServer},createServerReference:function(){return c.createServerReference},findSourceMapURL:function(){return l.findSourceMapURL}});let r=a(1209),l=a(5153),c=a(7197)},3017:(e,t,a)=>{"use strict";a.d(t,{N:()=>r});let r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;window.navigator&&window.navigator.vibrate&&window.navigator.vibrate(e)}},7012:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>j});var r=a(5155),l=a(2115),c=a(2619),s=a.n(c),n=a(63),o=a(3017),i=a(926);let d=(0,i.createServerReference)("40baa263e8300de102f880a285a3b0235c493709c3",i.callServer,void 0,i.findSourceMapURL,"getStoryById"),x=(0,i.createServerReference)("403b4c2c66a73096011e0fae043553b31317ce9403",i.callServer,void 0,i.findSourceMapURL,"getChaptersByStory");var h=a(358),p=a(7187),u=a(9338),m=a(4294);let b=(0,m.A)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),f=(0,m.A)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),g=(0,m.A)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),v=(0,m.A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);function y(){let e=(0,n.useSearchParams)(),t=e.get("id")||"",a="true"===e.get("interactive"),[c,i]=(0,l.useState)({hero1Name:e.get("hero1Name")||e.get("name")||"ton h\xe9ros",hero2Name:e.get("hero2Name")||"",world:e.get("world")||"For\xeat Enchant\xe9e",theme:e.get("theme")||"Aventure",title:e.get("title")||"",content:e.get("content")||"",imageUrl:""}),[m,y]=(0,l.useState)([]),[j,N]=(0,l.useState)(1),[k,w]=(0,l.useState)([]),[_,S]=(0,l.useState)(!!t),[A,C]=(0,l.useState)(0),[M,R]=(0,l.useState)(!1),[D,T]=(0,l.useState)(!1),L=(0,l.useRef)(null),q=(0,l.useRef)(null),z=(0,l.useRef)(null),E=!!c.hero2Name,P=c.title||"L'aventure de ".concat(c.hero1Name).concat(c.hero2Name?" et ".concat(c.hero2Name):"");(0,l.useEffect)(()=>{t?(async()=>{let e=await d(t);if(e.data){let r=e.data;if(i(e=>{var t;return{...e,hero1Name:(null==(t=r.profile)?void 0:t.first_name)||e.hero1Name,theme:r.theme||e.theme,title:r.title,content:r.content,imageUrl:r.image_url||""}}),a||"interactive"===r.story_type){let e=await x(t);e.data&&y(e.data)}}S(!1)})():S(!1)},[t,a]);let{hero1Name:F,hero2Name:U,world:I,theme:B,title:O,content:G,imageUrl:H}=c,V=E?"Il \xe9tait une fois, dans un monde appel\xe9 ".concat(I,", deux courageux amis nomm\xe9s ").concat(F," et ").concat(U,". L'aventure ne faisait que commencer..."):"Il \xe9tait une fois, dans un monde appel\xe9 ".concat(I,", un courageux h\xe9ros nomm\xe9 ").concat(F,". L'aventure ne faisait que commencer..."),X=[];if(m.length>0){let e=m.find(e=>e.chapter_number===j);e&&(X=[{type:"cover",content:null},{type:"chapter",content:[e.content],chapter:e},...e.has_choice?[{type:"choice",content:null,chapter:e}]:[],...e.is_ending?[{type:"end",content:null}]:[]])}else X=[{type:"cover",content:null},...(G||V).split("\n\n").filter(e=>e.trim()).map(e=>({type:"content",content:[e]})),{type:"end",content:null}];let Y=X.length,Q=X[A],J=()=>{A<Y-1&&!M&&((0,o.N)(),R(!0),setTimeout(()=>{C(e=>e+1),R(!1)},300))},K=()=>{A>0&&!M&&((0,o.N)(),R(!0),setTimeout(()=>{C(e=>e-1),R(!1)},300))},W=e=>{(0,o.N)();let t=m.find(e=>e.chapter_number===j);if(!t||!t.has_choice)return;let a="A"===e?t.choice_option_a_next_chapter:t.choice_option_b_next_chapter;a&&(w(t=>[...t,{chapter:j,choice:e}]),N(a),C(0))};return _?(0,r.jsxs)("div",{className:"h-screen bg-gradient-to-br from-amber-100 via-orange-50 to-amber-100 flex flex-col items-center justify-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 border-4 border-amber-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,r.jsx)("p",{className:"text-amber-800 font-bold text-lg",children:"Chargement de l'histoire..."})]}):(0,r.jsx)("div",{className:"h-screen bg-gradient-to-br from-amber-100 via-orange-50 to-amber-100 flex flex-col overflow-hidden",children:(0,r.jsxs)("div",{ref:z,className:"flex-1 w-full max-w-2xl mx-auto flex flex-col px-2 pb-2",onTouchStart:e=>{L.current=e.touches[0].clientX,q.current=e.touches[0].clientY},onTouchEnd:e=>{if(null===L.current||null===q.current)return;let t=L.current-e.changedTouches[0].clientX;Math.abs(t)>Math.abs(q.current-e.changedTouches[0].clientY)&&Math.abs(t)>50&&(t>0?J():K()),L.current=null,q.current=null},children:[(0,r.jsxs)("div",{className:"relative bg-amber-800 rounded-r-lg rounded-l-sm shadow-2xl p-1 sm:p-3 flex-1 flex flex-col h-full",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/20 rounded-r-lg rounded-l-sm transform translate-x-1 translate-y-1 sm:translate-x-3 sm:translate-y-3 -z-10"}),(0,r.jsx)("div",{className:"relative bg-white flex-1 rounded-r-md rounded-l-sm border-l-4 sm:border-l-8 border-amber-700 shadow-inner overflow-hidden h-full",children:(0,r.jsxs)("div",{className:"h-full flex flex-col relative",children:[(null==Q?void 0:Q.type)==="cover"&&(0,r.jsxs)("div",{className:"absolute inset-0 w-full h-full flex flex-col",children:[k.length>0&&(0,r.jsx)("div",{className:"absolute top-3 left-3 z-20 bg-purple-500 border-2 border-black px-2 py-1 shadow-[2px_2px_0px_rgba(0,0,0,1)]",children:(0,r.jsxs)("span",{className:"font-black text-xs text-white flex items-center gap-1",children:[(0,r.jsx)(h.A,{className:"w-3 h-3"}),k.length," choix"]})}),(0,r.jsxs)("div",{className:"absolute inset-0 w-full h-full bg-gradient-to-br from-indigo-400 via-purple-400 to-pink-400",children:[H?(0,r.jsx)("img",{src:H,alt:"Illustration",className:"w-full h-full object-cover"}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,r.jsx)(p.A,{className:"w-24 h-24 text-white/50"})}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-black/20"})]}),(0,r.jsxs)("div",{className:"relative z-10 mt-auto p-4 sm:p-8 text-center",children:[(0,r.jsx)("h1",{className:"text-3xl sm:text-5xl font-black text-white uppercase drop-shadow-[4px_4px_0px_rgba(0,0,0,1)] mb-2",children:P}),m.length>0&&(0,r.jsx)("div",{className:"inline-block bg-purple-500 border-2 border-black px-3 py-1 mb-3",children:(0,r.jsx)("span",{className:"font-black text-white text-sm",children:"\uD83C\uDFAD INTERACTIVE"})}),(0,r.jsx)("p",{className:"text-lg sm:text-2xl text-amber-300 font-bold",children:E?"".concat(F," & ").concat(U):F}),(0,r.jsxs)("div",{className:"flex gap-2 justify-center mt-4",children:[(0,r.jsx)("span",{className:"bg-amber-500 border-2 border-black px-3 py-1 font-black text-black text-sm",children:I}),(0,r.jsx)("span",{className:"bg-white border-2 border-black px-3 py-1 font-black text-black text-sm",children:B})]})]}),(0,r.jsx)("p",{className:"relative z-10 text-white/70 text-xs text-center pb-4",children:"→ Tourne la page pour commencer"})]}),(null==Q?void 0:Q.type)==="chapter"&&Q.chapter&&(0,r.jsxs)("div",{className:"flex flex-col h-full overflow-y-auto p-4 sm:p-8",children:[(0,r.jsx)("div",{className:"absolute top-3 right-3 z-20 bg-purple-100 border-2 border-purple-500 px-2 py-1",children:(0,r.jsxs)("span",{className:"font-black text-xs text-purple-700",children:["Ch. ",Q.chapter.chapter_number]})}),Q.chapter.title&&(0,r.jsx)("h2",{className:"text-xl font-black text-purple-900 mb-4 border-b-2 border-purple-200 pb-2",children:Q.chapter.title}),(0,r.jsx)("p",{className:"text-lg sm:text-xl leading-relaxed text-gray-800 font-medium",style:{fontFamily:"Georgia, serif"},children:Q.chapter.content}),Q.chapter.has_choice&&(0,r.jsx)("div",{className:"mt-6 bg-purple-50 border-4 border-purple-500 p-4 text-center",children:(0,r.jsx)("p",{className:"text-purple-700 font-bold text-sm",children:"Un choix s'impose... Tourne la page !"})})]}),(null==Q?void 0:Q.type)==="choice"&&Q.chapter&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-4 sm:p-8 bg-gradient-to-br from-purple-50 to-pink-50",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center border-4 border-black shadow-[6px_6px_0px_rgba(0,0,0,1)] mb-6",children:(0,r.jsx)(h.A,{className:"w-8 h-8 text-white"})}),(0,r.jsx)("h2",{className:"text-2xl font-black text-purple-900 text-center mb-4",children:"Que fais-tu ?"}),(0,r.jsx)("p",{className:"text-lg text-gray-700 text-center mb-8 max-w-md",children:Q.chapter.choice_question}),(0,r.jsxs)("div",{className:"flex flex-col gap-4 w-full max-w-md",children:[Q.chapter.choice_option_a&&(0,r.jsxs)("button",{onClick:()=>W("A"),className:"bg-gradient-to-r from-amber-400 to-orange-400 text-black font-black py-4 px-6 border-4 border-black shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] active:translate-x-1 active:translate-y-1 active:shadow-none text-lg",children:["\uD83C\uDD70️ ",Q.chapter.choice_option_a]}),Q.chapter.choice_option_b&&(0,r.jsxs)("button",{onClick:()=>W("B"),className:"bg-gradient-to-r from-purple-400 to-pink-400 text-black font-black py-4 px-6 border-4 border-black shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] active:translate-x-1 active:translate-y-1 active:shadow-none text-lg",children:["\uD83C\uDD71️ ",Q.chapter.choice_option_b]})]}),k.length>0&&(0,r.jsxs)("div",{className:"mt-8 text-center",children:[(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:"Choix pr\xe9c\xe9dents :"}),(0,r.jsx)("div",{className:"flex gap-2 justify-center mt-2",children:k.map((e,t)=>(0,r.jsx)("span",{className:"w-8 h-8 rounded-full border-2 border-black font-black flex items-center justify-center ".concat("A"===e.choice?"bg-amber-400":"bg-purple-400"),children:e.choice},t))})]})]}),(null==Q?void 0:Q.type)==="content"&&Q.content&&(0,r.jsxs)("div",{className:"flex flex-col h-full overflow-y-auto p-4 sm:p-8",children:[(0,r.jsx)("div",{className:"absolute top-3 right-3 z-20 bg-gray-100 border-2 border-black px-2 py-1",children:(0,r.jsxs)("span",{className:"font-black text-xs",children:[A," / ",Y-2]})}),(0,r.jsx)("p",{className:"text-lg sm:text-xl leading-relaxed text-gray-800 font-medium",style:{fontFamily:"Georgia, serif"},children:Q.content[0]})]}),(null==Q?void 0:Q.type)==="end"&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-6 p-4 sm:p-8",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-amber-500 rounded-full flex items-center justify-center border-4 border-black shadow-[6px_6px_0px_rgba(0,0,0,1)]",children:(0,r.jsx)(u.A,{className:"w-8 h-8 text-black"})}),(0,r.jsx)("h2",{className:"text-3xl font-black text-indigo-900 uppercase",children:m.length>0?"Ta Fin":"Fin"}),m.length>0&&k.length>0&&(0,r.jsxs)("div",{className:"bg-purple-100 border-4 border-purple-500 p-4",children:[(0,r.jsx)("p",{className:"text-purple-800 font-bold text-sm",children:"\uD83C\uDFAD Ton parcours :"}),(0,r.jsx)("div",{className:"flex gap-2 justify-center mt-2",children:k.map((e,t)=>(0,r.jsx)("span",{className:"w-8 h-8 rounded-full border-2 border-black font-black flex items-center justify-center ".concat("A"===e.choice?"bg-amber-400":"bg-purple-400"),children:e.choice},t))})]}),(0,r.jsx)("p",{className:"text-lg text-gray-600",children:E?"Et ils v\xe9curent heureux...":"Et v\xe9cut heureux..."}),(0,r.jsxs)("div",{className:"bg-indigo-50 border-4 border-indigo-200 p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Pour"}),(0,r.jsxs)("p",{className:"text-xl font-black text-indigo-900",children:[F,E&&" & ".concat(U)]})]}),m.length>0&&(0,r.jsx)("button",{onClick:()=>{(0,o.N)(),N(1),w([]),C(0)},className:"bg-purple-500 text-white font-black py-3 px-6 border-4 border-black shadow-[6px_6px_0px_rgba(0,0,0,1)] active:translate-x-1 active:translate-y-1 active:shadow-none",children:"\uD83D\uDD04 Rejouer"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 justify-center",children:[(0,r.jsxs)(s(),{href:"/",className:"bg-indigo-900 border-2 border-black px-4 py-2 text-white font-black text-sm shadow-[3px_3px_0px_rgba(0,0,0,1)] flex items-center gap-1",children:[(0,r.jsx)(b,{className:"w-4 h-4"})," Menu"]}),(0,r.jsxs)("button",{className:"bg-amber-500 border-2 border-black px-4 py-2 text-black font-black text-sm shadow-[3px_3px_0px_rgba(0,0,0,1)]",children:[(0,r.jsx)(f,{className:"w-4 h-4 inline"})," Partager"]})]})]})]})})]}),(null==Q?void 0:Q.type)!=="choice"&&(0,r.jsxs)("div",{className:"mt-2 flex items-center justify-center gap-2",children:[(0,r.jsx)("button",{onClick:K,disabled:0===A||M,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30",children:(0,r.jsx)(g,{className:"w-5 h-5"})}),(0,r.jsx)("div",{className:"flex gap-1",children:X.map((e,t)=>(0,r.jsx)("button",{onClick:()=>!M&&C(t),className:"w-1.5 h-1.5 rounded-full ".concat(t===A?"bg-amber-500 w-3":"bg-gray-300")},t))}),(0,r.jsx)("button",{onClick:J,disabled:A===Y-1||M,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30",children:(0,r.jsx)(v,{className:"w-5 h-5"})})]})]})})}function j(){return(0,r.jsx)(l.Suspense,{fallback:(0,r.jsx)("div",{className:"h-screen flex items-center justify-center bg-amber-50",children:(0,r.jsx)(p.A,{className:"w-16 h-16 text-amber-600 animate-pulse"})}),children:(0,r.jsx)(y,{})})}},7187:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(4294).A)("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]])},8541:(e,t,a)=>{Promise.resolve().then(a.bind(a,7012))},9338:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(4294).A)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]])}},e=>{e.O(0,[796,441,255,358],()=>e(e.s=8541)),_N_E=e.O()}]);